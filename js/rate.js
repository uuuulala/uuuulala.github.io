initRate();

function initRate() {

    const sliderEl = document.querySelector(".slider input");
    const ticksEls = Array.from(document.querySelectorAll(".ticks span"));

    const states = [{
        leftEye: "M174.6,48.4c5.3.6,9,8.1,8.2,16.8S177,80.6,171.7,80s-9-8.1-8.2-16.8S169.3,47.9,174.6,48.4Z",
        rightEye: "M249,74.9c-5,.2-9.3-6.2-9.6-14s3.5-14.4,8.5-14.5,9.3,6.2,9.6,14S254,74.8,249,74.9Z",
        month: "M224.5,96.7c11.1,7,18.9,16.9,15,27.4s-16.3,11.1-29.4,10.6c-16.7-.7-18.9-16.9-15-27.4S210.8,88.1,224.5,96.7Z",
        leftHand: {
            x: 0, y: 0, rotation: 0
        },
        rightHand: {
            x: 0, y: 0, rotation: 0
        }
    }, {
        leftEye: "M161.9,59.3c-1.8,5.1-5.6,8.4-8.5,7.4s-3.7-6-1.9-11.1,5.6-8.4,8.5-7.4S163.7,54.2,161.9,59.3Z",
        rightEye: "M287,55.4c2.1,5.9,1.1,11.6-2.2,12.8s-7.6-2.7-9.7-8.6S274,48,277.3,46.8,285,49.5,287,55.4Z",
        month: "M177.8,117.9a2,2,0,0,1-1.3-.4,2.5,2.5,0,0,1-.8-3.4c2.3-3.5,8.7-9.2,16.8-5.5s12.2,2.4,13.2,1.8c2.8-1.5,15.3-3.7,20.3.2,2.8,2.2,3.2,2.2,7.6-.2s15.7-2.4,19,.2a2.5,2.5,0,1,1-3,4c-1.4-1.1-9.7-2-13.6.2s-8,3.7-13.1-.2c-2.9-2.2-13-.8-14.9.2s-7.9,2.8-17.7-1.7c-6.1-2.8-10.1,2.9-10.5,3.6A2.2,2.2,0,0,1,177.8,117.9Z",
        leftHand: {
            x: 0, y: -8, rotation: -3
        },
        rightHand: {
            x: 18, y: 12, rotation: -20
        }
    }, {
        leftEye: "M155.6,55.5c-.5,8-4.5,14.3-9,14.1s-7.8-7-7.3-15,4.5-14.3,9-14.1S156,47.5,155.6,55.5Z",
        rightEye: "M279.5,55.1c2,7.8.1,15-4.2,16.1s-9.5-4.3-11.5-12-.1-15,4.2-16.1S277.5,47.3,279.5,55.1Z",
        month: "M203,113.1c-10.2.9-14,5-19,5a4,4,0,0,1-3-3,5.7,5.7,0,0,1,2-5c9.6-8.1,37-9,50-1a5.1,5.1,0,0,1,2,3c-.2,2.2-1.1,4.7-4,4C222,114.1,214.2,112.2,203,113.1Z",
        leftHand: {
            x: 5, y: 3, rotation: -160
        },
        rightHand: {
            x: 3, y: 5, rotation: 143
        }
    }, {
        leftEye: "M156.4,76.7c-.5,8-4.5,14.3-9,14.1s-7.8-7-7.3-15,4.5-14.3,9-14.1S156.9,68.7,156.4,76.7Z",
        rightEye: "M257.8,79c-.5,8-4.5,14.3-9,14.1s-7.7-7-7.3-15,4.5-14.3,9-14.1S258.3,70.9,257.8,79Z",
        month: "M202.7,113.6c-6-.4-13,2-19,2a2.7,2.7,0,0,1-2-2c-.2-1.4,0-2.7,1-3a70.4,70.4,0,0,1,20-3c15,1,19,2,26,2,2.1,0,11,0,12,1a3.5,3.5,0,0,1,1,3,3,3,0,0,1-2,2C233.7,116.6,218.7,114.6,202.7,113.6Z",
        leftHand: {
            x: -2, y: 12, rotation: -163
        },
        rightHand: {
            x: 1, y: -2, rotation: 155
        }
    }, {
        leftEye: "M146.7,53.2c0,8.2-3.7,14.9-8.3,14.9S130,61.5,130,53.2s3.7-14.9,8.3-14.9S146.6,45,146.7,53.2Z",
        rightEye: "M290.7,52.8c0,8.2-3.7,14.9-8.3,14.9s-8.3-6.6-8.4-14.8S277.7,38,282.3,38,290.7,44.6,290.7,52.8Z",
        month: "M210.4,119.2a77,77,0,0,1-18.7-2.4,3.9,3.9,0,1,1,2-7.6c13.1,3.4,33.6,3.1,43.9-3.5a3.9,3.9,0,0,1,4.2,6.6C234,117.3,222,119.4,210.4,119.2Z",
        leftHand: {
            x: -2, y: 25, rotation: -180
        },
        rightHand: {
            x: 10, y: 5, rotation: 155
        }
    }, {
        leftEye: "M154.8,51.9c-.7,11.5-6.4,20.5-12.8,20.1s-11.1-10-10.4-21.4,6.4-20.4,12.8-20S155.5,40.4,154.8,51.9Z",
        rightEye: "M295.7,60.2c-.7,11.7-6.5,20.8-13,20.4s-11.2-10.1-10.5-21.8,6.5-20.8,13-20.4S296.4,48.5,295.7,60.2Z",
        month: "M209.7,119.6a80.8,80.8,0,0,1-18.1-3.4,3.4,3.4,0,0,1,2.1-6.5c12.6,4.2,32.8,5.1,43.4-.8a3.4,3.4,0,0,1,3.4,6C232.6,119.2,220.9,120.4,209.7,119.6Z",
        leftHand: {
            x: -8, y: 12, rotation: -108
        },
        rightHand: {
            x: -2, y: 5, rotation: 110
        }
    }, {
        leftEye: "M159.7,59.3c-.7,11.9-6.7,21.2-13.3,20.8s-11.5-10.4-10.8-22.2,6.7-21.2,13.3-20.8S160.3,47.5,159.7,59.3Z",
        rightEye: "M290.3,59.2c.5,11.1-4.2,20.2-10.4,20.5s-11.6-8.5-12-19.6,4.2-20.2,10.4-20.5S289.9,48.1,290.3,59.2Z",
        month: "M218.4,130.5c-8-.6-19.4-9.9-25.8-12a4.2,4.2,0,0,1,2.6-8c15.5,5.1,40.2,6.2,53.2-1a4.2,4.2,0,0,1,4,7.4C242.9,122.2,232.1,131.6,218.4,130.5Z",
        leftHand: {
            x: -18, y: -2, rotation: -55
        },
        rightHand: {
            x: -4, y: 7, rotation: 82
        }
    }, {
        leftEye: "M163.6,59.7c-.6,10.5-6.8,18.7-13.9,18.3s-12.3-9.3-11.6-19.8S145,39.5,152,39.9,164.2,49.2,163.6,59.7Z",
        rightEye: "M286.6,62.7c.8,10.9-3.5,20-9.6,20.5s-11.6-8-12.4-18.8,3.5-20,9.6-20.5S285.9,51.8,286.6,62.7Z",
        month: "M213.4,139.9c-10-.8-24.2-9.3-33.4-15.9-2.3-1.7-5.8-4.9-4.8-7.6a5.2,5.2,0,0,1,6.6-3.3c19.4,6.4,50.3,7.7,66.4-1.2a5.2,5.2,0,0,1,7.1,2.1c1.4,2.5-.1,5-2.1,7.1C242.1,133.8,230.6,141.2,213.4,139.9Z",
        leftHand: {
            x: -18, y: -20, rotation: -65
        },
        rightHand: {
            x: -5, y: -9, rotation: 82
        }
    }, {
        leftEye: "M176.2,52.1c2.8,5.1-2.7,13.7-12.4,19.3s-19.9,6.1-22.7,1,2.8-13.7,12.4-19.3S173.3,47.1,176.2,52.1Z",
        rightEye: "M274.9,54.7c7.5,3,12.1,8.9,10.4,13.1s-9.1,5.1-16.6,2-12.1-8.9-10.4-13.1S267.5,51.7,274.9,54.7Z",
        month: "M209.2,138.7c-16.7-1.3-38-15.6-53.6-25h-.2a2.5,2.5,0,0,1,2-4.6c3.3,1,5.7,1.6,8.1,2.2,32.6,9.3,74.8,7,101.7-5a26.4,26.4,0,0,1,5.6-1.7,2.4,2.4,0,0,1,2.4,3.8c-3.1,3.7-7.5,8.6-10.7,10.7C249,133,238,140.8,209.2,138.7Z",
        leftHand: {
            x: -8, y: 0, rotation: -65

        },
        rightHand: {
            x: -5, y: -9, rotation: 46

        }
    }, {
        leftEye: "M152.7,57.2c-7.2,3.6-9.1,12.8-11.1,8.8s2.1-10.2,9.3-13.9,14.6-3.3,16.7.7S159.8,53.6,152.7,57.2Z",
        rightEye: "M281.4,55.2c7,3.9,10.9,10.3,8.7,14.2s-5.7-4.2-12.8-8.1-14.9-2.2-12.7-6.1S274.4,51.2,281.4,55.2Z",
        month: "M206.6,145.4c-39.5-9-45.5-17.9-63.2-31.3-2.3-1.7-5.2-5.9-7.4-9.5a2.7,2.7,0,0,1,3.3-4c8.3,3.1,13.1,4.5,17.5,5.9,37.5,12.7,84.2,3.9,117.9-9.5,2.8-1.1,6.6-2.4,10.1-3.5a4.1,4.1,0,0,1,4.9,5.9c-3.7,6.9-9,16.1-13.3,19.8C256.4,141.4,230.9,150.9,206.6,145.4Z",
        leftHand: {
            x: -14, y: -20, rotation: -60

        },
        rightHand: {
            x: 5, y: -25, rotation: 45

        }
    }];

    let rate = 0;

    sliderEl.oninput = function () {
        ticksEls[rate].classList.remove("active");
        rate = this.value;
        ticksEls[this.value].classList.add("active");
        animateAvatar(.4);
    };

    // Prepare graphics
    initGraphics();

    function initGraphics() {
        gsap.set(".hand--right", {
            svgOrigin: "314 189"
        });
        gsap.set(".hand--left", {
            svgOrigin: "131 189"
        });
    }

    function animateAvatar(dur) {
        gsap.to(".eye--left", {
            duration: dur,
            morphSVG: states[rate].leftEye
        });
        gsap.to(".eye--right", {
            duration: dur,
            morphSVG: states[rate].rightEye
        });
        gsap.to(".mouth", {
            duration: dur,
            morphSVG: states[rate].month
        });
        gsap.to(".hand--left", {
            duration: dur,
            x: states[rate].leftHand.x,
            y: states[rate].leftHand.y,
            rotation: states[rate].leftHand.rotation,
        });
        gsap.to(".hand--right", {
            duration: dur,
            x: states[rate].rightHand.x,
            y: states[rate].rightHand.y,
            rotation: states[rate].rightHand.rotation,
        });
    }

    gsap.timeline({
        scrollTrigger: {
            trigger: ".animation.rate",
            start: '0% 50%',
            end: '100% 50%',
            onEnter: () => {
                ticksEls[rate].classList.remove("active");
                rate = Math.floor(Math.random() * 10);
                ticksEls[rate].classList.add("active");
                animateAvatar(.4);
            },
            onEnterBack: () => {
                ticksEls[rate].classList.remove("active");
                rate = Math.floor(Math.random() * 10);
                ticksEls[rate].classList.add("active");
                animateAvatar(.4);
            }
        }
    });
}